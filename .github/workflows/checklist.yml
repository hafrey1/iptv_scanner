name: IPTV Scanner checklist

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:
    inputs:
      create_release:
        description: 'æ˜¯å¦åˆ›å»º Release'
        required: true
        type: boolean
        default: true
      version:
        description: 'ç‰ˆæœ¬å· (ä¾‹å¦‚: 3.0.0)'
        required: true
        type: string
        default: '3.0.0'

jobs:
  build-nuitka:
    name: IPTV Scanner checklist
    runs-on: windows-latest
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      - name: è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      - name: å®‰è£… C ç¼–è¯‘å™¨
        uses: ilammy/msvc-dev-cmd@v1
        continue-on-error: true
      
      - name: å®‰è£…ä¾èµ–
        run: |
          python -m pip install --upgrade pip
          pip install nuitka ordered-set zstandard
          pip install aiohttp numpy
        shell: cmd
      
      - name: ç¼–è¯‘ç¨‹åº (Nuitka)
        run: |
          nuitka --standalone --onefile ^
            --assume-yes-for-downloads ^
            --windows-console-mode=attach ^
            --output-filename=CheckList.exe ^
            --company-name="IPTV Tools" ^
            --product-name="IPTV CheckList" ^
            --file-version=1.0.0 ^
            --product-version=1.0.0 ^
            --file-description="é«˜æ€§èƒ½ IPTV é¢‘é“æ£€æµ‹å·¥å…·" ^
            --enable-plugin=numpy ^
            --follow-imports ^
            --nofollow-import-to=tkinter ^
            --nofollow-import-to=matplotlib ^
            checklist.py
        shell: cmd
        continue-on-error: false
      
      - name: ä¸Šä¼ æ„å»ºäº§ç‰©
        uses: actions/upload-artifact@v4
        with:
          name: CheckList_Windows_x64
          path: CheckList.exe
          retention-days: 90

  create-release:
    name: åˆ›å»º Release
    needs: [build-nuitka]
    runs-on: ubuntu-latest
    if: (startsWith(github.ref, 'refs/tags/')) || (github.event_name == 'workflow_dispatch' && inputs.create_release == true)
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      - name: ä¸‹è½½ç¼–è¯‘äº§ç‰©
        uses: actions/download-artifact@v4
        with:
          name: CheckList_Windows_x64
          path: ./release
      
      - name: åˆ›å»º Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ github.ref_name != '' && github.ref_name || format('v{0}', inputs.version) }}
          name: ${{ github.ref_name != '' && github.ref_name || format('Release v{0}', inputs.version) }}
          files: |
            release/CheckList.exe
          body: |
            ## ğŸš€ IPTV CheckList - Nuitka ä¼˜åŒ–ç‰ˆ
            
            ### â­ ç‰ˆæœ¬ç‰¹æ€§
            âš¡ è¿è¡Œæ€§èƒ½æå‡ 30-70%
            ğŸš„ å¯åŠ¨é€Ÿåº¦æå‡ 2-3 å€
            ğŸ“¦ ä½“ç§¯ä¼˜åŒ–ï¼ˆçº¦ 12-18 MBï¼‰
            ğŸ”’ ä»£ç ç¼–è¯‘ä¿æŠ¤
            ğŸ’¾ å†…å­˜ä½¿ç”¨æ›´ä¼˜åŒ–
            
            ### ğŸ“¥ ä½¿ç”¨æ–¹æ³•
            1. ä¸‹è½½ `CheckList.exe`
            2. ç¡®ä¿è„šæœ¬ä¾èµ–çš„é…ç½®æ–‡ä»¶åœ¨åŒä¸€ç›®å½•
            3. åŒå‡»è¿è¡Œå³å¯
            
            ### ğŸ” åŠŸèƒ½è¯´æ˜
            - è‡ªåŠ¨æ‰«æ IPTV é¢‘é“æº
            - TS æµç¨³å®šæ€§æ£€æµ‹
            - å“åº”æ—¶é—´æµ‹è¯•
            - ç”Ÿæˆ M3U æ’­æ”¾åˆ—è¡¨
            - è‡ªåŠ¨æ›´æ–° README ç»Ÿè®¡ä¿¡æ¯
            
            ### âš™ï¸ ç³»ç»Ÿè¦æ±‚
            - Windows 10 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆx64ï¼‰
            - æ— éœ€å®‰è£… Python ç¯å¢ƒ
            
            ### ğŸ“ é…ç½®è¯´æ˜
            ç¨‹åºä¼šè‡ªåŠ¨æ£€æµ‹ä»¥ä¸‹ç›®å½•ï¼š
            - è¾“å‡ºæ–‡ä»¶ï¼š`itvlist.m3u`
            - æ—¥å¿—æ›´æ–°ï¼š`./checklist/README.md`
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 

